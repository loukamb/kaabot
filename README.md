<img width="64" height="64" align="right" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3Cpath id='emojioneKaaba0' d='M33.2 44.5H62v10H33.2zm-18.7 0h8.8v10h-8.8z'/%3E%3C/defs%3E%3Cg fill='%233e4347'%3E%3Cpath d='M14.5 62L2 49.5V2l12.5 12.5zm0-47.5H62V62H14.5z'/%3E%3Cpath d='M62 14.5H14.5L2 2h47.5z'/%3E%3C/g%3E%3Cpath fill='%23e8e8e8' d='M15.5 12H56l-7.5-7.5H8z'/%3E%3Cpath fill='%23b2c1c0' d='m10.5 7l5 5h36.7l-5-5z'/%3E%3Cpath fill='%23dbb471' d='M14.5 29.5H62v5H14.5z'/%3E%3Cpath fill='%23b2c1c0' d='M14.5 62L2 49.5V2l12.5 12.5z' opacity='0.33'/%3E%3Cpath fill='%23fbbf67' d='M14.5 34.5L2 22v-5l12.5 12.5z'/%3E%3Cpath fill='%23dbb471' d='M39.5 37h13.8v5H39.5zm20 0H62v5h-2.5zm-45 0H17v5h-2.5zm23.2 1.6c-.6-.6-.3-1.1-.3-1.1l-1-.5l-1.1.5s.3.5-.3 1.1c-.3.3-.5.6-.5 1.1c0 .4.3.7.5 1c.3.6.7 1.3 1.4 1.3s1.1-.6 1.4-1.3c.2-.3.5-.6.5-1c-.1-.5-.3-.8-.6-1.1m-16.2 0c-.6-.6-.3-1.1-.3-1.1l-1.1-.5l-1.1.5s.3.5-.3 1.1c-.3.3-.5.6-.5 1.1c0 .4.3.7.5 1c.3.6.7 1.3 1.4 1.3s1.1-.6 1.4-1.3c.2-.3.5-.6.5-1c0-.5-.2-.8-.5-1.1m36.2 0c-.6-.6-.3-1.1-.3-1.1l-1-.5l-1.1.5s.3.5-.3 1.1c-.3.3-.5.6-.5 1.1c0 .4.3.7.5 1c.3.6.7 1.3 1.4 1.3s1.1-.6 1.4-1.3c.2-.3.5-.6.5-1c-.1-.5-.3-.8-.6-1.1'/%3E%3Cpath fill='%23fbbf67' d='M13.2 35.8v5l1.3 1.2v-5z'/%3E%3Cuse href='%23emojioneKaaba0' fill='%23e8e8e8'/%3E%3Cpath fill='%23fbbf67' d='M12.5 36.5c-.2-.8-.1-1.2-.1-1.2l-.4-.8l-.4.1s.1.6-.1 1c-.1.2-.2.5-.2.9s.1.8.2 1.2c.1.7.2 1.5.5 1.7c.2.2.4-.3.5-.8c.1-.3.2-.5.2-.9c-.1-.4-.2-.8-.2-1.2m-5-5c-.2-.8-.1-1.2-.1-1.2l-.4-.8l-.4.1s.1.6-.1 1c-.1.2-.2.5-.2.9s.1.8.2 1.2c.1.7.2 1.5.5 1.7c.2.2.4-.3.5-.8c.1-.3.2-.5.2-.9c-.1-.4-.2-.8-.2-1.2m.7-.7v5l2.5 2.4v-5zm-5-5v5l2.6 2.4v-5z'/%3E%3Cpath fill='%23e8e8e8' d='m2 42l12.5 12.5v-10L2 32z'/%3E%3Cuse href='%23emojioneKaaba0' fill='%233e4347' opacity='0.2'/%3E%3Cpath fill='%23dbb471' d='M14.5 54.5H62V62H14.5z'/%3E%3Cpath fill='%233e4347' d='M14.5 54.5H62V62H14.5z' opacity='0.5'/%3E%3Cpath fill='%23dbb471' d='M14.5 62L2 49.5V42l12.5 12.5z'/%3E%3Cpath fill='%233e4347' d='M14.5 62L2 49.5V42l12.5 12.5z' opacity='0.25'/%3E%3Cpath fill='%23ffce31' d='M23.2 42h10v17.5h-10z'/%3E%3Cg fill='%23f2b200'%3E%3Cpath d='M23.2 58.2h10v1.2h-10z'/%3E%3Cpath d='M32 37h1.2v22.5H32z'/%3E%3C/g%3E%3Cpath fill='%23dbb471' d='M23.2 37v17.5h4.3l.7-5l.8 5h4.2V37z'/%3E%3Cg fill='%23fff'%3E%3Cpath d='M30.8 47h-5.1l-1.2-1.2l1.2-1.3h5.1l1.2 1.3z' opacity='0.33'/%3E%3Ccircle cx='30.8' cy='50.8' r='1.3' opacity='0.33'/%3E%3Ccircle cx='25.8' cy='50.8' r='1.2' opacity='0.33'/%3E%3Cpath d='M25.8 41c-.2-.2-.1-.4-.1-.4l-.4-.2l-.4.2s.1.2-.1.4c-.1.1-.2.3-.2.4c0 .2.1.3.2.4c.1.3.3.5.6.5s.4-.3.6-.5c.1-.1.2-.3.2-.4c-.2-.1-.3-.3-.4-.4m2 0c-.2-.2-.1-.4-.1-.4l-.4-.2l-.4.2s.1.2-.1.4c-.1.1-.2.3-.2.4c0 .2.1.3.2.4c.1.3.3.5.6.5s.4-.3.6-.5c.1-.1.2-.3.2-.4c-.2-.1-.3-.3-.4-.4m2 0c-.2-.2-.1-.4-.1-.4l-.4-.2l-.4.2s.1.2-.1.4c-.1.1-.2.3-.2.4c0 .2.1.3.2.4c.1.3.3.5.6.5s.4-.3.6-.5c.1-.1.2-.3.2-.4c-.2-.1-.3-.3-.4-.4m2 0c-.2-.2-.1-.4-.1-.4l-.4-.2l-.4.2s.1.2-.1.4c-.1.1-.2.3-.2.4c0 .2.1.3.2.4c.1.3.3.5.6.5s.4-.3.6-.5c.1-.1.2-.3.2-.4c-.2-.1-.3-.3-.4-.4' opacity='0.33'/%3E%3C/g%3E%3Cpath fill='%23dbb471' d='m14.5 59.3l-1.7-1.7v-2.1l1.7 1.7v-.4l-3.6-3.6v-2.3l-.3-.3v2.3l-2.2-2.2v-2.3l-.3-.3v2.3L4.7 47v-2.3l-.3-.3v2.3L2 44.3v.4l.8.8v2.1l-.8-.8v.4l2.3 2.3v2.3l.3.3v-2.3L6.8 52v2.3l.3.3v-2.3l4.1 4.1v2.3l.3.3v-2.3l3 3zm-8.9-8.9l-2.5-2.5v-2.1l2.5 2.5zm3.7 3.7l-3.4-3.4v-2.1L9.3 52zm3.2 3.1l-2.8-2.8v-2.1l2.8 2.8zm49.5 0v-.3h-5.5v-2.3h-.3v2.3h-4.8v-2.3h-.3v2.3h-4.6v-2.3h-.3v2.3h-4.1v-2.3h-.3v2.3h-5.3v-2.3h-.3v2.3h-3v.3H38v2.2H20.3v-2.2h3v-.3h-4.8v-2.3h-.3v2.3h-3.6v.3H20v2.2h-5.5v.3h1.1V62h.3v-2.3h5.9V62h.3v-2.3H27V62h.3v-2.3H31V62h.3v-2.3h2.9V62h.3v-2.3H40V62h.3v-2.3h5V62h.3v-2.3H51V62h.3v-2.3h4.8V62h.3v-2.3H62v-.3h-3.6v-2.2zm-18.3 2.1h-5.3v-2.2h5.3zm3.8 0H44v-2.2h3.4zm5.6 0h-5.3v-2.2h5.3zm5 0h-4.7v-2.2h4.7z'/%3E%3C/svg%3E">
<h1>Kaab'ot</h1>

Pretty little Discord bot that provides knowledge on Islam, the Holy Quran, and various information sourced from the Ahmadiyya Muslim Jama'at.

### Features

- Cite verses from the Holy Quran with the `/verse` command. Provides English, Arabic, and Urdu translations automatically.
  - Analyze the individual Arabic words of each verse by passing the optional `analyse` parameter.
  - Verses provided from [OpenQuran](https://www.openquran.com/), an Ahmadi project.
- Fetch the latest Friday Sermon from [Muslim Television Ahmadiyya International](https://beta.mta.tv/).
  - Provides both a permalink on MTA **and** a direct download link to a 1920x1080 (full HD) MP4 of the sermon.
  - Pass `list` parameter to retrieve the last 10 Friday sermons.
- Convert between Gregorian and Hijri dates using `/calendar`, understands both precise (e.g., "March 10, 2024") **and** imprecise/relative (e.g., "next friday", "2 weeks from now", etc.) inputs.

### Upcoming features

- On-demand retrieval of Salat timings, as well as an opt-in notifier/reminder for prayers with configurable location(s).
  - **TODO:** Reverse engineer endpoints on alislam.org's Adhan pages ([1](https://www.alislam.org/adhan/calendar), [2](https://www.alislam.org/adhan)) **or** find out the Dhuhr and Fajr/Isha angles used by AMJ. Scraping not doable due to the pages immediately defaulting to your IP geolocation.
- Arabic translator and/or word look-up.
- Built-in index of the writings of Hazrat Mirza Ghulam Ahmad (a.s.) with links to PDFs and their translations.
  - **TODO:** This index need to be manually built as these writings are not centralized on alislam.org. Will do eventually.
  - **TODO:** Also do this for the Khalifas.
- Embeddable Friday sermons (so they display in Discord channels)
  - A prototype video embedder is setup as a Cloudflare Worker at [syn.tv](https://github.com/mblouka/syntv) and while it _does_ embed, it breaks after a few seconds due to the size of the video.
  - **TODO:** Figure out how a lower-quality version of the sermon can be retrieved for embeds exclusively. Probably by parsing the m3u8 playlist.
- Retrieval of translations & subtitles for Friday sermons (when available).
  - **TODO:** Reverse engineer the confusing Akamai video formats used by MTA.
- Search, browse, and embed programs streamed right from MTA.
  - **TODO:** See if it's possible to implement some kind of search functionality.
- Hijri → Gregorian conversion. Sadly the libraries used do not easily parse Hijri dates, only Gregorian dates. Gregorian → Hijri however works perfectly.
- User suggestions (if any).

## Usage

This project requires [Node.js](https://nodejs.org/en) 20 or above. **There is currently no (official) public instance of the bot.** For now, you will have to host it yourself.

[Create a Discord bot first, making sure to invite it to your guild(s) immediately after.](https://discord.com/developers/docs/getting-started#step-1-creating-an-app) Then, clone this repository into an empty folder, and create a `.env` file with the following values:

```shell
# Insert your bot's client ID here.
DISCORD_BOT_CLIENT="..."

# Insert your bot's token here.
DISCORD_BOT_SECRET="..."

# Insert the guild IDs here, separated by commas.
GUILDS="123456789,123456789,123456789"
```

Afterwards, run the following commands and the bot will launch automatically:

```shell
npm run build
# or "pnpm build" if you have pnpm.

npm run start
# or "pnpm start" if you have pnpm.
```

## License

This work is licensed under the GNU Affero General Public License (AGPL) Version 3. For more information, consult [the license file.](/LICENSE)
